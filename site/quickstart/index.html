<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Zhunag ShaoBo">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>快速开始 - PowerGate</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u5feb\u901f\u5f00\u59cb";
    var mkdocs_page_input_path = "quickstart.md";
    var mkdocs_page_url = "/quickstart/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-510626-7', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PowerGate</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">简介</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">快速开始</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#powergate">安装PowerGate网关</a></li>
                
            
                <li class="toctree-l3"><a href="#python-sdk">安装Python SDK</a></li>
                
            
                <li class="toctree-l3"><a href="#_1">编写策略</a></li>
                
            
                <li class="toctree-l3"><a href="#powergate_1">运行PowerGate网关</a></li>
                
            
                <li class="toctree-l3"><a href="#_2">运行策略</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../concept/">重要概念</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../terminal/">网关程序</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../examples/">更多例子</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../sdk/">策略SDK</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PowerGate</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>快速开始</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>完整的PowerGate包括一个可执行的网关程序，及相应的编程语言SDK。<br />
用户使用SDK编写交易策略，网关程序加载策略进行交易。</p>
<p>我们将利用PowerGate运行一个非常简单的交易策略，以此讲解它的使用方法。 </p>
<h2 id="powergate">安装PowerGate网关</h2>
<p><a href="https://sourceforge.net/projects/powergate/files/latest/download">点击此处</a>下载PowerGate网关安装程序。<br />
   网关程序的安装过程与普通应用程序的安装过程一样，它的使用说明请看<a href="../terminal/index.html">这里</a>。 <br />
   PowerGate内置支持多种交易通道，在此我们使用CTP期货模拟通道：一是因为模拟通道可以提供7x24小时服务；二是因为CTP期货通道提供每秒至少两次的Tick数据，我们可以更快地看到策略的运行结果。   </p>
<h2 id="python-sdk">安装Python SDK</h2>
<p><a href="https://sourceforge.net/projects/powergate-sdk-python/files/latest/download">点击此处</a>下载PowerGate Python SDK。<br />
   目前SDK支持Win32 Python27。请确保电脑上已经安装了Python27，安装程序<a href="https://www.python.org/ftp/python/2.7.13/python-2.7.13.msi">点击此处</a>下载。</p>
<h2 id="_1">编写策略</h2>
<p>我们编写一个简单的“均线金叉死叉”交易策略。<br />
   策略原理相当简单：以Tick数据为基础，当10周期均线上穿40周期均线时做多，当10周期均线下穿40周期均线时做空，每次均以对手价下单。（<font color=#FF0000>这是一个高效的‘碎钞机’，所以千万别用自己的实盘账号运行这个策略！</font>）<br />
   打开你喜爱的代码编辑器，复制粘贴下面的代码，并以文件名“macross.py”保存，或者直接到<a href="https://github.com/algo-trade/powergate-examples-python">此处</a>下载代码。</p>
<pre><code>    # -*- coding: utf-8 -*- 
    import math
    from PowerGate import StrategyBase     #策略基类
    from PowerGate import StrategyConfig   #策略配置
    from PowerGate import MA               #均线
    from PowerGate import Cross            #均线穿越验证

    class MACross(StrategyBase):
        def __init__(self, *args, **kwargs):
            super(MACross, self).__init__(*args, **kwargs)
            self.ma_short = MA()
            self.ma_long = MA()

        def onStart(self):
            #获取Tick最新价数据序列,Tick数据序列会被系统自动填充
            self.series = self.getTickSeries().getLastPriceDataSeries()

            #以Tick最新价数据序列和相应周期初始化两根均线
            self.ma_short.init(self.series, 10)
            self.ma_long.init(self.series, 40)

        def onTick(self, tick):
            #如果均线还没有可用的计算值，直接返回
            #ma_short的周期参数为10，当Tick最新价数据序列被10个Tick填充时，ma_short获得第一个MA值
            if math.isnan(self.ma_short[0]):
                return

            #ma_long的周期参数为40，当Tick最新价数据序列被40个Tick填充时，ma_short获得第一个MA值
            if math.isnan(self.ma_long[0]):
                return

            #打印Tick及两条均线的最新值
            print('CLOSE=%f  MA[10]=%f  MA[40]=%f' % (tick.lastPrice, 
                                                      self.ma_short[0], 
                                                      self.ma_long[0]))
            #短均线上穿长均线
            if Cross.crossAbove(self.ma_short, self.ma_long): 
                print('Cross Above')
                #以策略订阅的主合约为标的，做多1手
                self.openLong(self.getMainInstrument(), 1)
            #短均线下穿长均线
            elif Cross.crossBelow(self.ma_short, self.ma_long): 
                print('Cross Below')
                #以策略订阅的主合约为标的，做空1手
                self.openShort(self.getMainInstrument(), 1)

    if __name__ == '__main__':
        config = StrategyConfig()
        #设置策略名称，每个策略必须有一个名称
        config.setName('MACross')
        #如果只订阅一个合约，那么该合约就是策略主合约，否则第一个订阅的合约为策略主合约
        config.subscribe("rb1710")

        #策略实例
        strategy = MACross()
        #运行策略  
        strategy.run(config)         
        #等待用户输入
        raw_input()
        #停止策略
        strategy.stop()
</code></pre>
<h2 id="powergate_1">运行PowerGate网关</h2>
<p>请以CTP模拟账户登录PowerGate网关程序。如果没有模拟账户，请到<a href="http://www.simnow.com.cn/">SimNow网站</a>注册。</p>
<p><img alt="" src="../img/PowerGate-login.png" />  </p>
<h2 id="_2">运行策略</h2>
<p>网关程序启动完毕，打开命令行窗口，运行交易策略：</p>
<pre><code>    python macross.py
</code></pre>
<p>策略运行时的输出如下：</p>
<pre><code>[2017/05/17 19:00:26.465][I] +===============================================================+
[2017/05/17 19:00:26.465][I] *   ALGORITHMIC STRATEGY ENGINE [build: May 17 2017 08:22:36]   *
[2017/05/17 19:00:26.465][I] +===============================================================+
[2017/05/17 19:00:26.465][I] Engine initializing...
[2017/05/17 19:00:26.465][W] Could not load data dictionary!
[2017/05/17 19:00:26.465][I] Load timer service 'SysTimer' done.
[2017/05/17 19:00:26.465][I] Load market data service 'RemoteMD' done.
[2017/05/17 19:00:26.465][I] Load order execution service 'RemoteExec' done.
[2017/05/17 19:00:26.465][I] Total services loaded: 3.
[2017/05/17 19:00:26.465][I] Load strategy 'MACross' succeed!
[2017/05/17 19:00:26.465][I] Connect to remote engine at address 127.0.0.1:5501...
[2017/05/17 19:00:26.554][I] Trading Account Detail [SrvID: 0]:
=======================================
     Account ID: xxxxxx
        Balance: 1284363.160000
   Realized P/L: 0.000000
        MTM P/L: 480.000000
  Client Equity: 1284363.160000
     Commission: 0.000000
Margin Occupied: 171002.000000
     Fund Avail: 988639.160000
    Risk Degree: 0.000000
=======================================
[2017/05/17 19:00:26.555][I] Execution service 'RemoteExec' ready.
[2017/05/17 19:00:26.555][I] Check auto start...
[2017/05/17 19:00:26.555][I] Total runtime number: 1.
[2017/05/17 19:00:26.555][I] Strategy 'MACross' loading...
CLOSE=2976.000000  MA[10]=2975.900000  MA[40]=2975.550000
......
CLOSE=2975.000000  MA[10]=2975.700000  MA[40]=2975.725000
Cross Below
[2017/05/17 19:00:55.835][I] [MACross] Raw: Short, rb1710, 1.0, 2975, 2017-05-16 19:49:15.500, 172386781, 1
[2017/05/17 19:00:55.899][I] [MACross] Raw-Ack: Finished, Short, rb1710, 1.0, 2975, 1.0, 2975, 2017-05-16 19:49:15.500, 172386843, 1
CLOSE=2975.000000  MA[10]=2975.600000  MA[40]=2975.725000
......
CLOSE=2976.000000  MA[10]=2975.900000  MA[40]=2975.800000
Cross Above
[2017/05/17 19:01:00.851][I] [MACross] Raw: Cover, rb1710, 1.0, 2977, 2017-05-16 19:49:20.500, 172391796, 2
[2017/05/17 19:01:00.852][I] [MACross] Raw: Buy, rb1710, 1.0, 2977, 2017-05-16 19:49:20.500, 172391796, 3
[2017/05/17 19:01:00.903][I] [MACross] Raw-Ack: Finished, Cover, rb1710, 1.0, 2977, 1.0, 2977, 2017-05-16 19:49:20.500, 172391859, 2
[2017/05/17 19:01:00.904][I] [MACross] Raw-Ack: Finished, Buy, rb1710, 1.0, 2977, 1.0, 2977, 2017-05-16 19:49:20.500, 172391859, 3
</code></pre>
<p>等待片刻，如果均线有交叉，我们就能看到PowerGate按照策略的指示交易指定合约。在网关界面上我们能看到策略的仓位一直在翻转，因为这是一个时时在场的策略。<br />
至此，我们已经完成了一个简单的“算法交易策略”的开发与部署。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../concept/" class="btn btn-neutral float-right" title="重要概念">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="简介"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../concept/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
